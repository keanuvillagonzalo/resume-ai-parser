<!DOCTYPE html>
<html>
<head>
    <title>Upload Resume</title>
    <style>
        body { font-family: sans-serif; padding: 50px; line-height: 1.6; }
        #result { background: #f4f4f4; padding: 20px; border-radius: 8px; margin-top: 20px; white-space: pre-wrap; }
        .loading { color: blue; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Resume Parser (Flask + Gemini 2.5 Flash-Lite)</h1>
     <div id="resumeHistory">Loading history...</div>
    <input type="file" id="resumeInput">
    <button onclick="processResume()">Process Resume</button> 
   
   

    <div id="status"></div>
    <div id="result">Results will appear here...</div>

    <button style="margin-top: 10px;" onclick="window.location.href='/'">-> Job Description</button>

    <script>
        async function processResume() {
            const fileInput = document.getElementById('resumeInput');
            const status = document.getElementById('status');
            const resultDiv = document.getElementById('result');

            if (!fileInput.files[0]) return alert("Select a file first!");

            const formData = new FormData();
            formData.append('resume', fileInput.files[0]);

            status.innerHTML = '<p class="loading">Uploading and processing... please wait.</p>';
            resultDiv.innerText = "";

            try {
                const response = await fetch('/upload', { method: 'POST', body: formData });
                const data = await response.json();

                if (data.success) {
                    status.innerHTML = '<p style="color:green">Success!</p>';
                    resultDiv.innerText = JSON.stringify(JSON.parse(data.data), null, 2);
                } else {
                    status.innerHTML = `<p style="color:red">Error: ${data.error}</p>`;
                }
            } catch (err) {
                status.innerHTML = `<p style="color:red">Server Error: ${err.message}</p>`;
            }
        }




        // Load history when the page opens
    window.onload = loadHistory;

    async function loadHistory() {
        const historyDiv = document.getElementById('resumeHistory');
        try {
            const response = await fetch('/resumes');
            const resumes = await response.json();

            if (resumes.length === 0) {
                historyDiv.innerHTML = "<p>No resumes uploaded yet.</p>";
                return;
            }

            let html = '<table border="1" style="width:100%; border-collapse: collapse; text-align: left;">';
            html += '<tr><th style="padding:10px;">Filename</th><th style="padding:10px;">Actions</th></tr>';
            
            resumes.forEach(res => {
                html += `
                <tr>
                    <td style="padding:10px;">${res.filename}</td>
                    <td style="padding:10px;">
                        <button onclick="deleteResume(${res.id})" style="background-color: #ff4444; color: white; border: none; padding: 5px 10px; cursor: pointer;">Delete</button>
                    </td>
                </tr>`;
            });
            html += '</table>';
            historyDiv.innerHTML = html;
        } catch (err) {
            historyDiv.innerHTML = "Error loading history.";
        }
    }

    async function deleteResume(id) {
        if (!confirm("Are you sure you want to delete this resume?")) return;

        try {
            const response = await fetch(`/delete/${id}`, { method: 'DELETE' });
            const data = await response.json();
            if (data.success) {
                loadHistory(); // Refresh the list
            } else {
                alert("Delete failed: " + data.error);
            }
        } catch (err) {
            alert("Error: " + err.message);
        }
    }
    
    // Update your existing processResume function to refresh the list on success
    // Just add 'loadHistory();' inside the 'if (data.success)' block!
    </script>
</body>
</html>